<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Homepage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="javascript" href="homepagefunctions.js" type="script" media="screen"/>
</head>
<body class="homepage">
<div id="weatherwisebot">
    <div id="weatherwiseicon">
        <img src ="Images/Alt lOGO.png" id="AILOGO" />
    </div>
    <div id="weatherwisecontainer" class="hidden">
        <div id="weatherwiseheader">
            <span>ChatBot</span>
            <button id="closebtn">&times;</button>
        </div>
        <div id="weatherwisebody">
            <div id="weatherwisemessages">  </div>  </div>  <div id="prompts">
            <button class="promptbtn">How's the weather today?</button>
            <button class="promptbtn">What is the average temperature today?</button>
            <button class="promptbtn">Is it going to rain between 3 & 6 today?</button>
            <button class="promptbtn">Are flights on schedule today?</button>
            <button class="promptbtn">Is it safe to go do my shopping today?</button>
        </div>
        <div id="weatherwiseinputcontainer">
            <input type="text" id="weatherwiseinput" placeholder="Type a message...."/>
            <button id="sendbtn">Send</button> 
        </div>  </div></div>
<script src="chatbot.js"></script>

    <!--Location -->

 <script>
  var popup = document.getElementById("profile-popup");
  var openBtn = document.getElementById("open-profile");
  var closeBtn = document.getElementById("close-popup");
  var saveBtn = document.getElementById("save-settings");
  var locationSelect = document.getElementById("profile-location");

  openBtn.onclick = function () { popup.classList.remove("hidden"); };
  closeBtn.onclick = function () { popup.classList.add("hidden"); };
 saveBtn.onclick = function () {
    saveWidgetSettings();
    var selectedLocation = locationSelect.value;
    localStorage.setItem("homeLocation", selectedLocation);

    popup.classList.add("hidden");
    updateHomeLocation();
    fetchWeather(); // refresh weather for new location
  };
  function loadProfileSettings() {
    var savedLocation = localStorage.getItem("homeLocation");
    if (savedLocation) {
      locationSelect.value = savedLocation;
      updateHomeLocation();
    }
  }

  function updateHomeLocation() {
    var locName = localStorage.getItem("homeLocation") || "Cork City";
    document.querySelector(".location-name").textContent = locName + ", Cork";
  }
  loadProfileSettings();
</script>
  <script>
function fetchWeather() {
  
  var lat = 51.8985;
  var lon = -8.4756;

  var location = localStorage.getItem("homeLocation");

  if (location === "Ovens") {
    lat = 51.8743;
    lon = -8.6890;
  } else if (location === "Doneraile") {
    lat = 52.2167;
    lon = -8.6667;
  } else if (location === "Kinsale") {
    lat = 51.7079;
    lon = -8.5308;
  } else if (location === "Bishopstown") {
    lat = 51.8801;
    lon = -8.5120;
  }

  var query =
    "latitude=" + lat +
    "&longitude=" + lon +
    "&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,wind_gusts_10m_max,sunrise,sunset,uv_index_max" +
    "&timezone=auto&wind_speed_unit=kmh&precipitation_unit=mm";

  var url = "https://webdevcit.com/notes/getweather.php?" + query;

  var script = document.createElement("script");
  script.src = url;
  document.body.appendChild(script);
}
</script>

 <!--  
   function getLocation() 
    {
    navigator.geolocation.getCurrentPosition( showCoords );
  }
function showCoords (position) {
     
 var devLatitude = position.coords.latitude;
var devLongitude = position.coords.longitude;
      document.getElementById("current_coords").innerHTML = "lat: " + devLatitude + " long: " + devLongitude;
    }  
 window.addEventListener("load", init);
 function init()
    {	 document.getElementById("get_coords_but").addEventListener("click", getLocation) } -->

</script>
 <<div id="sidebar">
    <button id="close-sidebar" aria-label="Close menu">√ó</button>
  
    <h3 class="sidebar-title">Menu</h3>
  
    <p>
      <input type="button" value="Find my location" id="get_coords_but">
      <div id="current_coords"></div>
    </p>
  
    <p>
      <button id="logout_sidebar" onclick="window.location.href='login.html'">
        Log Out
      </button>
    </p>
  </div>
  
  <!-- header -->
  <header class="top-header">

    <button class="burger" id="burger" value="burger"></button>

    <div class="header-logo">
      <img src="logoexample5.png" alt="MMSD logo" />
    </div>

    <button class="header-icon" id="open-profile" value="Account"></button>
  </header>

  <!-- warning sign -->
  <div class="warning-bar">
    <div class="warning-bar-left">
      <span class="warning-icon">‚ö†Ô∏è</span>
      <span class="warning-text">Rain Warning: Status Yellow</span>
      <span class="warning-chevron">‚Ä∫</span>
    </div>
    
  </div>

  <main class="home-shell">

    <section class="top-section">

      <div class="top-left">
        <div class="today-header">  <div>
            <div class="today-label">Today</div>
            <div class="today-date" id="today-date">Loading...</div>
          </div>
          <div class="today-location-row">
           <span class="location-icon">üìç</span>
            <span class="location-name">Cork City, Cork</span>
          </div>
        </div>

        <div class="search-row">
          <input class="location-search" type="text" placeholder="Search location..." />
          <button class="search-clear" aria-label="Clear search">√ó</button>
        </div>

  <div class="card card-weather">
          <div class="card-weather-main">
            <div class="temp-block"><div class="temp-main" id="current-temp">--¬∞</div>
              <div class="temp-feels" id="current-feels">Feels like --¬∞</div>
            </div>

 <div class="icon-block">
 <div class="icon-item">
    <div class="icon-symbol" id="current-icon">‚òÅÔ∏è</div>  <div class="icon-label" id="current-condition">Loading...</div>
              </div>

 <div class="icon-item">
  <!-- <div class="icon-symbol" id="moon-icon">üåí</div>  <div class="icon-label"  id="moon-phase-label"   >Moon Phase</div>-->
  </div>
 </div>
   </div>

          <div class="card-weather-details">
            <div class="detail-column">
         <div class="detail-row"><span class="rain-icon"></span> <span id="current-rain">Rain -- mm</span></div>
        <div class="detail-row"><span class="wind-icon"></span> <span id="current-wind">Wind -- km/h</span></div>
              <div class="detail-row"><span class="gust-icon"></span> <span id="current-gust">Gust -- km/h</span></div>
            </div>
  <div class="detail-column">
              <div class="detail-row"><span class="sunrise-icon"></span> <span id="sunrise">Sunrise --:--</span></div>
              <div class="detail-row"><span class="sunset-icon"></span> <span id="sunset">Sunset --:--</span></div>
        <div class="detail-row"><span class="UV-icon"></span> <span id="uv-index">UV --</span></div>
            </div>        </div>
        </div>   </div>

      <div class="top-right">
        <div class="card kinsale-graphic">
          <img src="old head of kinsale.png" alt="Old Head of Kinsale" />
        </div>
    <div class="card card-tomorrow">
          <div class="tomorrow-header">
            <div class="tomorrow-title">Tomorrow</div>
            <div class="tomorrow-date" id="tomorrow-date">Loading...</div>
          </div>
  <div class="tomorrow-main">
            <div class="tomorrow-temp-block">
              <div class="temp-main" id="tomorrow-temp">--¬∞</div>
              <div class="temp-minmax" id="tomorrow-minmax">--¬∞</div>
            </div>
            <div class="tomorrow-conditions" id="tomorrow-conditions">
              <div>Loading...</div>
            </div>
          </div>  </div> </div>
 </section>
 <section class="hourly-row">
  <div class="card card-hourly">
    <div class="card-heading">Hourly Forecast</div>
    <div class="hourly-strip" id="hourly-strip"></div>
  </div>
</section> <section class="forecast-row">
      <div class="card card-7day">
        <div class="card-heading">7-Day Forecast</div>
        <div class="forecast-strip" id="forecast-strip"></div>
      </div>
    </section>  <section class="bottom-widgets">
      <div class="card bottom-card hover-card" data-widget="marine">
        <div class="bottom-icon">‚öì</div> Marine
      </div>
  <div class="card bottom-card hover-card" data-widget="health">
        <div class="bottom-icon">‚ûï</div> Health
      </div>   <div class="card bottom-card hover-card" data-widget="outdoor">
        <div class="bottom-icon">üìÖ</div> Outdoor Planner
      </div>
      <div class="card card-farming hover-card" data-widget="farming">
        <div class="farming-icon">üå±</div>
        <div class="farming-label">Farming</div>
      </div>
      <div class="card bottom-card hover-card" data-widget="pollen">
        <div class="bottom-icon">üåº</div>
        <div class="bottom-label">Pollen</div>
      </div>
    </section>
    <!-- popup before widgets for all -->
<div id="widget-popup" class="popup hidden">
  <div class="popup-inner" id="widget-popup-inner">
    <h2 id="widget-popup-title">Widget</h2>
    <div id="widget-popup-content">Loading...</div>

    <button id="close-widget-popup" class="close-btn">Close</button>
  </div>
</div>

  </main>
  <div id="profile-popup" class="popup hidden">
    <div class="popup-inner">
      <h2>Edit Profile</h2>

      <label>Name</label>
      <input type="text" id="profile-name" placeholder="Your name..." />

      <h3>Home Location</h3>
      <select id="profile-location">
        <option value="">Select Location</option>
        <option value="Ovens">Ovens</option>
        <option value="Doneraile">Doneraile</option>
        <option value="Kinsale">Kinsale</option>
        <option value="Bishopstown">Bishopstown</option>
      </select>

      <h3>Choose Widgets</h3>
      <label><input type="checkbox" data-widget-toggle="marine"> Marine</label><br>
      <label><input type="checkbox" data-widget-toggle="health"> Health</label><br>
      <label><input type="checkbox" data-widget-toggle="outdoor"> Outdoor Planner</label><br><label><input type="checkbox" data-widget-toggle="farming"> Farming</label><br>
      <label><input type="checkbox" data-widget-toggle="pollen"> Pollen</label><br><br>

      <button id="save-settings">Save</button>
      <button id="close-popup" class="close-btn">Close</button>
    </div>
  </div>

 
  <!-- Sscript for api from garys website, i dont know if i downloaded it with everything we need or if you can edit it -->
  <script>
    
    var widgetPopup = document.getElementById("widget-popup");
var popupTitle = document.getElementById("widget-popup-title");
var popupContent = document.getElementById("widget-popup-content");
var closeWidgetPopup = document.getElementById("close-widget-popup");

var widgets = document.querySelectorAll("[data-widget]");

for (var i = 0; i < widgets.length; i++) {
  widgets[i].addEventListener("click", function () {

var widgetName = this.getAttribute("data-widget");
popupTitle.textContent = widgetName.toUpperCase();

if (!weatherData) {
  popupContent.innerHTML = "Getting today‚Äôs data...";
  widgetPopup.classList.remove("hidden");
  return;
}

var d = weatherData.daily;

var rain = Math.round(d.precipitation_sum[0]) || "--";
var wind = Math.round(d.wind_speed_10m_max[0]) || "--";
var gust = Math.round(d.wind_gusts_10m_max[0]) || "--";
var max  = Math.round(d.temperature_2m_max[0]) || "--";
var min  = Math.round(d.temperature_2m_min[0]) || "--";


if (widgetName === "marine") {
  popupContent.innerHTML = `
    <div>üåä <b>Marine report</b></div>
    <br>
    Wind: ${wind} km/h <br>
    Gusts: ${gust} km/h <br>
    Rain: ${rain} mm <br>
    Air temp: ${max}¬∞ / ${min}¬∞
  `;
}

if (widgetName === "health") {
  popupContent.innerHTML = `
    <div>‚ûï <b>Health info</b></div>
 
 
    Temp today: ${max}¬∞ <br>
    Wind: ${wind} km/h <br>
    Rain: ${rain} mm <br><br>
    
  `;
}

if (widgetName === "outdoor") {
  popupContent.innerHTML = `
    <div>üìÖ <b>Outdoor planner</b></div>
    <br>
  Max temp: ${max}¬∞ <br>
    Rain today: ${rain} mm <br>
 Wind: ${wind} km/h <br><br>
    A drier, warmer part of the day is usually best for being outside.
  `;
}

if (widgetName === "farming") {
  popupContent.innerHTML = `
    <div>üå± <b>Farming forecast</b></div>
    <br>
    Rain today: ${rain} mm <br>
 Wind: ${wind} km/h <br>
 Temp: ${max}¬∞ <br><br>
    Use this to get a quick sense of field and general farming conditions.
  `;
}

if (widgetName === "pollen") {
  popupContent.innerHTML = `
    <div>üåº <b>Pollen overview</b></div>
    <br>
 Rain today: ${rain} mm <br><br>
 More rain usually means -> less pollen in the air 
    On drier days, pollen is more active.
  `;
}

widgetPopup.classList.remove("hidden");
});

}

closeWidgetPopup.onclick = function () {
  widgetPopup.classList.add("hidden");
};


closeWidgetPopup.onclick = function () {
  widgetPopup.classList.add("hidden");
};

   function saveWidgetSettings() {
      var toggles = document.querySelectorAll("[data-widget-toggle]");
      var settings = {};

      for (var i = 0; i < toggles.length; i++) {
        var widget = toggles[i].getAttribute("data-widget-toggle");
        settings[widget] = toggles[i].checked;
      }

      localStorage.setItem("widgetSettings", JSON.stringify(settings));
      loadWidgetSettings();
    }

    function loadWidgetSettings() {
      var settings = JSON.parse(localStorage.getItem("widgetSettings"));
      if (!settings) return;

      var widgets = document.querySelectorAll("[data-widget]");

      for (var i = 0; i < widgets.length; i++) {
        var name = widgets[i].getAttribute("data-widget");
        widgets[i].style.display = settings[name] === false ? "none" : "block";
      }
  var toggles = document.querySelectorAll("[data-widget-toggle]");
      for (var j = 0; j < toggles.length; j++) {
        var name = toggles[j].getAttribute("data-widget-toggle");
        toggles[j].checked = settings[name] !== false;
      }
    }

    loadWidgetSettings();

    var popup = document.getElementById("profile-popup");
    var openBtn = document.getElementById("open-profile");
    var closeBtn = document.getElementById("close-popup");
    var saveBtn = document.getElementById("save-settings");
    var locationSelect = document.getElementById("profile-location");

    openBtn.onclick = function () { popup.classList.remove("hidden"); };
    closeBtn.onclick = function () { popup.classList.add("hidden"); };
    saveBtn.onclick = function () {
      saveWidgetSettings();
      var selectedLocation = locationSelect.value;
  localStorage.setItem("homeLocation", selectedLocation);

  // 3. Update UI text
  updateHomeLocation();

  // 4. Refetch weather for new coords
  fetchWeather();
      popup.classList.add("hidden");
    };
    var weatherData = null;
 function processWeather(data) {
      console.log("Weather received:", data);
      weatherData = data;  // save for popups

      var max = data.daily.temperature_2m_max;
      var min = data.daily.temperature_2m_min;
      var codes = data.daily.weather_code;
      var times = data.daily.time;

      var rain = data.daily.precipitation_sum;
      var wind = data.daily.wind_speed_10m_max;
      var gust = data.daily.wind_gusts_10m_max;
      var sunrise = data.daily.sunrise;
var sunset = data.daily.sunset;
var uv = data.daily.uv_index_max;
var moon = data.daily.moon_phase;
// HOURLY FORECAST
var hourlyTimes = data.hourly.time;
var hourlyTemp = data.hourly.temperature_2m;
var hourlyRain = data.hourly.precipitation_probability;
var hourlyCodes = data.hourly.weather_code;

var conditionMap = {
  0:  "Clear sky",
  1:  "Mainly clear",
  2:  "Partly cloudy",
  3:  "Overcast",
  45: "Fog",
  48: "Fog",
  51: "Light drizzle",
  53: "Drizzle",
  55: "Heavy drizzle",
  61: "Light rain",
  63: "Rain",
  65: "Heavy rain",
  71: "Light snow",
  73: "Snow",
  75: "Heavy snow",
  80: "Rain showers",
  81: "Rain showers",
  82: "Heavy showers",
  85: "Snow showers",
  86: "Snow showers",
  95: "Thunderstorm",
  96: "Thunderstorm + hail",
  99: "Thunderstorm + hail"
};
   var iconMap = {
  0: "‚òÄÔ∏è",   
  1: "üå§Ô∏è",  
  2: "‚õÖ",   
  3: "‚òÅÔ∏è",   
  45: "üå´Ô∏è",  
  48: "üå´Ô∏è",  
  51: "üå¶Ô∏è",  
  53: "üå¶Ô∏è",
  55: "üå¶Ô∏è",
  61: "üåßÔ∏è",  
  63: "üåßÔ∏è",
  65: "üåßÔ∏è",
  71: "‚ùÑÔ∏è",  
  73: "‚ùÑÔ∏è",
  75: "‚ùÑÔ∏è",
  80: "üå¶Ô∏è",  
  81: "üå¶Ô∏è",
  82: "üåßÔ∏è",
  85: "üå®Ô∏è",  
  86: "üå®Ô∏è",
  95: "‚õàÔ∏è",  
  96: "‚õàÔ∏è",
  99: "‚õàÔ∏è"
};

      /* today */
      document.getElementById("current-temp").textContent = Math.round(max[0]) + "¬∞";
      document.getElementById("current-feels").textContent = "Feels like " + Math.round(min[0]) + "¬∞";
      document.getElementById("today-date").textContent = times[0];
      document.getElementById("current-condition").textContent = conditionMap[codes[0]];
      document.getElementById("current-icon").textContent = iconMap[codes[0]];
      document.getElementById("current-rain").textContent = "Rain " + Math.round(rain[0]) + " mm";
      document.getElementById("current-wind").textContent = "Wind " + Math.round(wind[0]) + " km/h";
      document.getElementById("current-gust").textContent = "Gust " + Math.round(gust[0]) + " km/h";
      document.getElementById("sunrise").textContent =
  "Sunrise " + sunrise[0].slice(11,16);

document.getElementById("sunset").textContent =
  "Sunset " + sunset[0].slice(11,16);

document.getElementById("uv-index").textContent =
  "UV " + uv[0];
    /* tomorrow */
      document.getElementById("tomorrow-temp").textContent = Math.round(max[1]) + "¬∞";
      document.getElementById("tomorrow-minmax").textContent = Math.round(min[1]) + "¬∞";
      document.getElementById("tomorrow-date").textContent = times[1];

      document.getElementById("tomorrow-conditions").innerHTML =
        conditionMap[codes[1]] + "<br>" +
        "üíß " + Math.round(rain[1]) + " mm<br>" +
        "üí® " + Math.round(wind[1]) + " km/h";

    // hourly bar
var hourlyTimes = data.hourly.time;
var hourlyTemp = data.hourly.temperature_2m;
var hourlyRain = data.hourly.precipitation_probability;
var hourlyCodes = data.hourly.weather_code;

var hourlyStrip = document.getElementById("hourly-strip");
hourlyStrip.innerHTML = "";
for (var h = 0; h < 12; h++) {
  var hourLabel = hourlyTimes[h].slice(11, 16); // "14:00"
  var hTemp = Math.round(hourlyTemp[h]);
  var hRain = hourlyRain[h];
  var hIcon = iconMap[ hourlyCodes[h] ] || "‚òÅÔ∏è";

  var div = document.createElement("div");
  div.className = "hour-slot hover-card";

  div.innerHTML =
    "<div class='hour-label'>" + hourLabel + "</div>" +
    "<div class='hour-icon'>" + hIcon + "</div>" +
    "<div class='hour-temp'>" + hTemp + "¬∞</div>" +
    "<div class='hour-rain'>" + hRain + "%</div>";

  hourlyStrip.appendChild(div);
}

      var strip = document.getElementById("forecast-strip");
      strip.innerHTML = "";

      for (var i = 0; i < 7; i++) {
        var dateObj = new Date(times[i]);
        var dayName = dateObj.toLocaleDateString("en-GB", { weekday: "short" });

        var div = document.createElement("div");
        div.className = "forecast-day hover-card";

        div.innerHTML =
          "<div class='forecast-day-label'>" + dayName + "</div>" +
          "<div class='forecast-icon'>" + iconMap[codes[i]] + "</div>" +
          "<div class='forecast-temp'>" + Math.round(max[i]) + "¬∞</div>" +
          "<div class='forecast-rain'>üíß " + Math.round(rain[i]) + " mm</div>" +
          "<div class='forecast-wind'>üå¨Ô∏è " + Math.round(wind[i]) + " km/h</div>" +
          "<div class='forecast-gust'>üí® " + Math.round(gust[i]) + " km/h</div>";

        strip.appendChild(div);
      }
    }
    var burger = document.getElementById("burger");
  var sidebar = document.getElementById("sidebar");
  var closeSidebar = document.getElementById("close-sidebar");

  if (burger && sidebar && closeSidebar) {
    burger.onclick = function () {
      sidebar.classList.add("open");
    };

    closeSidebar.onclick = function () {
      sidebar.classList.remove("open");
    };
  }
  loadProfileSettings();
    updateHomeLocation();
    fetchWeather();

    
    function fetchWeather() {
      var lat = 51.8985;
      var lon = -8.4756;
  var location = localStorage.getItem("homeLocation");
    
      if (location === "Ovens") {
        lat = 51.8743; lon = -8.6890;
      } else if (location === "Doneraile") {
        lat = 52.2167; lon = -8.6667;
      } else if (location === "Kinsale") {
        lat = 51.7079; lon = -8.5308;
      } else if (location === "Bishopstown") {
        lat = 51.8801; lon = -8.5120;
      }
  var query =
        "latitude=" + lat +
        "&longitude=" + lon +
        "&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,wind_gusts_10m_max,sunrise,sunset,uv_index_max&hourly=temperature_2m,precipitation_probability,weather_code" +
        "&timezone=auto&wind_speed_unit=kmh&precipitation_unit=mm";

      var url = "https://webdevcit.com/notes/getweather.php?" + query;

      var script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }
    

    fetchWeather();

  </script>

</body>
</html>
