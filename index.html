<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Homepage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="javascript" href="homepagefunctions.js" type="script" media="screen"/>
</head>

<body class="homepage">

<!--CHATBOT-->
<div id="weatherwisebot">
    <div id="weatherwiseicon">
        <img src ="Images/Alt lOGO.png" id="AILOGO" />
    </div>
    <div id="weatherwisecontainer" class="hidden">
        <div id="weatherwiseheader">
            <span>ChatBot</span>
            <button id="closebtn">&times;</button>
        </div>
        <div id="weatherwisebody">
            <div id="weatherwisemessages">
                
            </div>
        </div>

        <div id="prompts">
            <button class="promptbtn">How's the weather today?</button>
            <button class="promptbtn">What is the average temperature today?</button>
            <button class="promptbtn">Is it going to rain between 3 & 6 today?</button>
            <button class="promptbtn">Are flights on schedule today?</button>
            <button class="promptbtn">Is it safe to go do my shopping today?</button>
        </div>
        <div id="weatherwiseinputcontainer">
            <input type="text" id="weatherwiseinput" placeholder="Type a message...."/>
            <button id="sendbtn">Send</button> 
        </div>
    </div>
</div>

<script src="chatbot.js"></script>

    <!--Location coords-->

 <script>

   function getLocation() 
    {
    navigator.geolocation.getCurrentPosition( showCoords );
  }


 function showCoords (position) {

            
     var devLatitude = position.coords.latitude;
     var devLongitude = position.coords.longitude;
            
         document.getElementById("current_coords").innerHTML = "lat: " + devLatitude + " long: " + devLongitude;
    }  


    window.addEventListener("load", init);

    function init()
    {	
    document.getElementById("get_coords_but").addEventListener("click", getLocation)		
    }

</script>

  <!--side bar-->
  <div id="sidebar">
        <p><input type = "button" value = "Find my location" id = "get_coords_but" >
              <div id = "current_coords"></div>
        </p>
        <p><button id="logout_sidebar" value="logout" onclick="logout()">Log Out</button>
        </p>

  </div>

  <script>

      document.getElementById("burger").addEventListener("click", showSidebar());

      function showSidebar(){
        document.getElementById("sidebar").style.display = "block";
      };
    
  </script>


  <!-- header -->
  <header class="top-header">

    <button class="burger" id="burger" value="burger"></button>

    <div class="header-logo">
      <img src="logoexample5.png" alt="MMSD logo" />
    </div>

    <button class="header-icon" id="open-profile" value="Account">ğŸ‘¤</button>
  </header>

  <!-- warning -->
  <div class="warning-bar">
    <div class="warning-bar-left">
      <span class="warning-icon">âš ï¸</span>
      <span class="warning-text">Rain Warning: Status Yellow</span>
      <span class="warning-chevron">â€º</span>
    </div>
    <button class="warning-settings" aria-label="Warning settings">âš™ï¸</button>
  </div>

  <main class="home-shell">

    <!-- TODAY + TOMORROW -->
    <section class="top-section">

      <div class="top-left">
        <div class="today-header">
          <div>
            <div class="today-label">Today</div>
            <div class="today-date" id="today-date">Loading...</div>
          </div>
          <div class="today-location-row">
            <span class="location-icon">ğŸ“</span>
            <span class="location-name">Cork City, Cork</span>
          </div>
        </div>

        <div class="search-row">
          <input class="location-search" type="text" placeholder="Search location..." />
          <button class="search-clear" aria-label="Clear search">Ã—</button>
        </div>

        <div class="card card-weather">
          <div class="card-weather-main">
            <div class="temp-block">
              <div class="temp-main" id="current-temp">--Â°</div>
              <div class="temp-feels" id="current-feels">Feels like --Â°</div>
            </div>

            <div class="icon-block">
              <div class="icon-item">
                <div class="icon-symbol" id="current-icon">â˜ï¸</div>
                <div class="icon-label" id="current-condition">Loading...</div>
              </div>

              <div class="icon-item">
                <div class="icon-symbol">ğŸŒ’</div>
                <div class="icon-label">Moon Phase</div>
              </div>
            </div>
          </div>

          <div class="card-weather-details">
            <div class="detail-column">
              <div class="detail-row"><span class="detail-icon">ğŸ’§</span> <span id="current-rain">Rain -- mm</span></div>
              <div class="detail-row"><span class="detail-icon">ğŸ’¨</span> <span id="current-wind">Wind -- km/h</span></div>
              <div class="detail-row"><span class="detail-icon">ğŸŒ¬ï¸</span> <span id="current-gust">Gust -- km/h</span></div>
            </div>

            <div class="detail-column">
              <div class="detail-row"><span class="detail-icon">ğŸŒ…</span> <span id="sunrise">Sunrise --:--</span></div>
              <div class="detail-row"><span class="detail-icon">ğŸŒ‡</span> <span id="sunset">Sunset --:--</span></div>
              <div class="detail-row"><span class="detail-icon">â˜€ï¸</span> <span id="uv-index">UV --</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="top-right">
        <div class="card kinsale-graphic">
          <img src="old head of kinsale.png" alt="Old Head of Kinsale" />
        </div>

        <div class="card card-tomorrow">
          <div class="tomorrow-header">
            <div class="tomorrow-title">Tomorrow</div>
            <div class="tomorrow-date" id="tomorrow-date">Loading...</div>
          </div>

          <div class="tomorrow-main">
            <div class="tomorrow-temp-block">
              <div class="temp-main" id="tomorrow-temp">--Â°</div>
              <div class="temp-minmax" id="tomorrow-minmax">--Â°</div>
            </div>

            <div class="tomorrow-conditions" id="tomorrow-conditions">
              <div>Loading...</div>
            </div>
          </div>

      
        </div>
      </div>

    </section>

    <!-- 7 DAY FORECAST -->
    <section class="forecast-row">
      <div class="card card-7day">
        <div class="card-heading">7-Day Forecast</div>
        <div class="forecast-strip" id="forecast-strip"></div>
      </div>
    </section>

    <!-- WIDGETS -->
    <section class="bottom-widgets">
      <div class="card bottom-card hover-card" data-widget="marine">
        <div class="bottom-icon">âš“</div> Marine
      </div>

      <div class="card bottom-card hover-card" data-widget="health">
        <div class="bottom-icon">â•</div> Health
      </div>

      <div class="card bottom-card hover-card" data-widget="outdoor">
        <div class="bottom-icon">ğŸ“…</div> Outdoor Planner
      </div>
      <div class="card card-farming hover-card" data-widget="farming">
        <div class="farming-icon">ğŸŒ±</div>
        <div class="farming-label">Farming</div>
      </div>
      <div class="card bottom-card hover-card" data-widget="pollen">
        <div class="bottom-icon">ğŸŒ¼</div>
        <div class="bottom-label">Pollen</div>
      </div>
    </section>

  </main>

  <!-- POPUP FOR PROFILE + WIDGET SETTINGS -->
  <div id="profile-popup" class="popup hidden">
    <div class="popup-inner">
      <h2>Edit Profile</h2>

      <label>Name</label>
      <input type="text" id="profile-name" placeholder="Your name..." />

      <h3>Choose Widgets</h3>
      <label><input type="checkbox" data-widget-toggle="marine"> Marine</label><br>
      <label><input type="checkbox" data-widget-toggle="health"> Health</label><br>
      <label><input type="checkbox" data-widget-toggle="outdoor"> Outdoor Planner</label><br><label><input type="checkbox" data-widget-toggle="farming"> Farming</label><br>
      <label><input type="checkbox" data-widget-toggle="pollen"> Pollen</label><br><br>

      <button id="save-settings">Save</button>
      <button id="close-popup" class="close-btn">Close</button>
    </div>
  </div>

 
  <!-- Sscript for api from garys website, i dont know if i downloaded it with everything we need or if you can edit it -->
  <script>
   function saveWidgetSettings() {
      var toggles = document.querySelectorAll("[data-widget-toggle]");
      var settings = {};

      for (var i = 0; i < toggles.length; i++) {
        var widget = toggles[i].getAttribute("data-widget-toggle");
        settings[widget] = toggles[i].checked;
      }

      localStorage.setItem("widgetSettings", JSON.stringify(settings));
      loadWidgetSettings();
    }

    function loadWidgetSettings() {
      var settings = JSON.parse(localStorage.getItem("widgetSettings"));
      if (!settings) return;

      var widgets = document.querySelectorAll("[data-widget]");

      for (var i = 0; i < widgets.length; i++) {
        var name = widgets[i].getAttribute("data-widget");
        widgets[i].style.display = settings[name] === false ? "none" : "block";
      }

      var toggles = document.querySelectorAll("[data-widget-toggle]");
      for (var j = 0; j < toggles.length; j++) {
        var name = toggles[j].getAttribute("data-widget-toggle");
        toggles[j].checked = settings[name] !== false;
      }
    }

    loadWidgetSettings();

    /* ------------------------------
       PROFILE POPUP
    ------------------------------ */

    var popup = document.getElementById("profile-popup");
    var openBtn = document.getElementById("open-profile");
    var closeBtn = document.getElementById("close-popup");
    var saveBtn = document.getElementById("save-settings");

    openBtn.onclick = function () { popup.classList.remove("hidden"); };
    closeBtn.onclick = function () { popup.classList.add("hidden"); };
    saveBtn.onclick = function () {
      saveWidgetSettings();
      popup.classList.add("hidden");
    };

    /* ------------------------------
       WEATHER API
    ------------------------------ */

    function processWeather(data) {
      console.log("Weather received:", data);

      var max = data.daily.temperature_2m_max;
      var min = data.daily.temperature_2m_min;
      var codes = data.daily.weather_code;
      var times = data.daily.time;

      var rain = data.daily.precipitation_sum;
      var wind = data.daily.wind_speed_10m_max;
      var gust = data.daily.wind_gusts_10m_max;

      var conditionMap = {
        0: "Clear Sky",
        1: "Mainly Clear",
        2: "Partly Cloudy",
        3: "Cloudy",
        51: "Drizzle",
        61: "Rain",
        71: "Snow",
        95: "Thunderstorm"
      };

      var iconMap = {
        0: "â˜€ï¸",
        1: "ğŸŒ¤ï¸",
        2: "â›…",
        3: "â˜ï¸",
        51: "ğŸŒ¦ï¸",
        61: "ğŸŒ§ï¸",
        71: "â„ï¸",
        95: "â›ˆï¸"
      };

      /* TODAY */
      document.getElementById("current-temp").textContent = Math.round(max[0]) + "Â°";
      document.getElementById("current-feels").textContent = "Feels like " + Math.round(min[0]) + "Â°";
      document.getElementById("today-date").textContent = times[0];
      document.getElementById("current-condition").textContent = conditionMap[codes[0]];
      document.getElementById("current-icon").textContent = iconMap[codes[0]];
      document.getElementById("current-rain").textContent = "Rain " + Math.round(rain[0]) + " mm";
      document.getElementById("current-wind").textContent = "Wind " + Math.round(wind[0]) + " km/h";
      document.getElementById("current-gust").textContent = "Gust " + Math.round(gust[0]) + " km/h";

      /* TOMORROW */
      document.getElementById("tomorrow-temp").textContent = Math.round(max[1]) + "Â°";
      document.getElementById("tomorrow-minmax").textContent = Math.round(min[1]) + "Â°";
      document.getElementById("tomorrow-date").textContent = times[1];

      document.getElementById("tomorrow-conditions").innerHTML =
        conditionMap[codes[1]] + "<br>" +
        "ğŸ’§ " + Math.round(rain[1]) + " mm<br>" +
        "ğŸ’¨ " + Math.round(wind[1]) + " km/h";

      /* 7-DAY FORECAST */
      var strip = document.getElementById("forecast-strip");
      strip.innerHTML = "";

      for (var i = 0; i < 7; i++) {
        var dateObj = new Date(times[i]);
        var dayName = dateObj.toLocaleDateString("en-GB", { weekday: "short" });

        var div = document.createElement("div");
        div.className = "forecast-day hover-card";

        div.innerHTML =
          "<div class='forecast-day-label'>" + dayName + "</div>" +
          "<div class='forecast-icon'>" + iconMap[codes[i]] + "</div>" +
          "<div class='forecast-temp'>" + Math.round(max[i]) + "Â°</div>" +
          "<div class='forecast-rain'>ğŸ’§ " + Math.round(rain[i]) + " mm</div>" +
          "<div class='forecast-wind'>ğŸŒ¬ï¸ " + Math.round(wind[i]) + " km/h</div>" +
          "<div class='forecast-gust'>ğŸ’¨ " + Math.round(gust[i]) + " km/h</div>";

        strip.appendChild(div);
      }
    }

    function fetchWeather() {
      var lat = 51.8985;
      var lon = -8.4756;

      var query =
        "latitude=" + lat +
        "&longitude=" + lon +
        "&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,wind_gusts_10m_max" +
        "&timezone=auto&wind_speed_unit=kmh&precipitation_unit=mm";

      var url = "https://webdevcit.com/notes/getweather.php?" + query;

      var script = document.createElement("script");
      script.src = url;
      document.body.appendChild(script);
    }

    fetchWeather();

  </script>

</body>
</html>

